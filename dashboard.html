<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard - Dhito Pro CRM</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="css/ui.css">
</head>
<body class="dark">

<script src="js/auth.js"></script>
<script>protect()</script>

<header class="top">
  <h2>Dhito Pro CRM</h2>
  <button onclick="logout()" class="ghost">Logout</button>
</header>

<!-- OVERLAY -->
<div id="overlay" class="overlay" onclick="closeSidebar()"></div>

<!-- SIDEBAR -->
<div id="sidebar" class="sidebar">
  <div class="logo">Dhito Pro CRM</div>

  <a href="dashboard.html" class="active">ğŸ  Dashboard</a>
  <a href="leads.html">ğŸ“‡ Konsumen</a>
  <a href="followup.html">ğŸ”” Follow Up</a>
</div>

<!-- TOP BAR -->
<div class="topbar">
  <button class="menu-btn" onclick="openSidebar()">â˜°</button>
  <h2>Dashboard</h2>
</div>

<div class="container">

  <div class="grid grid-3">
    <div class="card stat">
      <h3 id="total">0</h3>
      <p class="sub">Total Leads</p>
    </div>
    <div class="card stat">
      <h3 id="today">0</h3>
      <p class="sub">Follow Up Hari Ini</p>
    </div>
    <div class="card stat">
      <h3 id="closing">0</h3>
      <p class="sub">Closing</p>
    </div>
  </div>

  <div class="card">
    <h3>ğŸ”” Follow Up Hari Ini</h3>
    <ul id="reminder"></ul>
  </div>

</div>

<script src="js/db.js"></script>
<script src="js/pipeline.js"></script>
<script>
function loadDashboard(){
  getLeads(data=>{
    total.innerText = data.length;

    const todayList = data.filter(d => isToday(d.nextFollow));
    today.innerText = todayList.length;

    closing.innerText = data.filter(d=>d.status==="Closing").length;

    pNew.innerText = data.filter(d=>d.status==="New").length;
    pFu.innerText = data.filter(d=>d.status==="Follow Up").length;
    pSurvey.innerText = data.filter(d=>d.status==="Survey").length;
    pClose.innerText = data.filter(d=>d.status==="Closing").length;

    reminder.innerHTML = "";
    if(todayList.length===0){
      reminder.innerHTML = "<li><i>Tidak ada follow up hari ini</i></li>";
    }
    todayList.forEach(d=>{
      reminder.innerHTML += `
        <li>
          <b>${d.nama}</b><br>
          ${d.hp}<br>
          <a href="followup.html?id=${d.id}">Follow Up</a>
        </li>
      `;
    });
  });
}

function openSidebar(){
  sidebar.classList.add("show");
  overlay.classList.add("show");
}
function closeSidebar(){
  sidebar.classList.remove("show");
  overlay.classList.remove("show");
}

setTimeout(loadDashboard,800);
</script>

</body>
</html>
